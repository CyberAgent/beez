/**
 * @name suns.js
 * @author Kazuma MISHIMAGI <mishimagi_kazuma@cyberagent.co.jp>
 * copyright (c) Cyberagent Inc.
 * @overview Object extending utilities for node and browser (amd support)
 */

/**
 * @name bucks.js
 * @author Kazuma MISHIMAGI <mishimagi_kazuma@cyberagent.co.jp>
 * copyright (c) Cyberagent Inc.
 * @overview Async chain utility for node and the browser. (amd support)
 */

/**
 * @name logcafe.js
 * @author Kei Funagayama <funagayama_kei@cyberagent.co.jp>
 * copyright (c) Cyberagent Inc.
 * @overview browser logging.
 */

/**
 * @license beez Copyright (c) Cyberagent Inc.
 * Available via the MIT License.
 */

/* Zepto v1.0-1-ga3cab6c - polyfill zepto detect event ajax form fx - zeptojs.com/license */

/**
 * @name index.js<beez-ua>
 * @author Kei Funagayama <funagayama_kei@cyberagent.co.jp>
 * copyright (c) Cyberagent Inc.
 * @overview UserAgent decision  for node and the browser. (amd support) fork zepto.js(http://zeptojs.com/)
 * @license MIT
 */

/**
 * @name base.js<beez-mvcr>
 * @author Kei Funagayama <funagayama_kei@cyberagent.co.jp>
 * copyright (c) Cyberagent Inc.
 * @overview base class of managed object
 */

/* JSONPath 0.8.0 - XPath for JSON
         *
         * Copyright (c) 2007 Stefan Goessner (goessner.net)
         * Licensed under the MIT (MIT-LICENSE.txt) licence.
         *
         * @license https://github.com/s3u/JSONPath
         */

/**
 * @name base.js<beez-mvcr>
 * @author Kazuma MISHIMAGI <mishimagi_kazuma@cyberagent.co.jp">
 * copyright (c) Cyberagent Inc.
 * @overview base class of managed object
 */

/** @license MIT License (c) 2012-2013 Cyberagent Inc. */

(function(e){var t=Array.prototype.forEach,r={},i=function i(e,i,n){if(void 0!==e&&null!==e)if(t&&e.forEach===t)e.forEach(i,n);else if(e.length===+e.length){for(var o=0,s=e.length;s>o;o++)if(i.call(n,e[o],o,e)===r)return}else for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)&&i.call(n,e[a],a,e)===r)return},n=function(e){return i(Array.prototype.slice.call(arguments,1),function(t){for(var r in t)e[r]=t[r]}),e},o=/__(super)+__/,s=function s(e,t,r){var i;if("object"!=typeof r)throw Error("typeof childCtorOrProto invalid. it should be Object (prototype object).");i=r&&Object.prototype.hasOwnProperty.call(r,"constructor")?r.constructor:Function("parent","return function "+e+"(){ parent.apply(this, arguments); };")(t),n(i,t);var s=function(){this.constructor=i};s.prototype=t.prototype,i.prototype=new s,r&&n(i.prototype,r);for(var a in t)if(o.test(a)){var u=a.replace("super","supersuper");i[u]=t[a]}return i.__super__=t.prototype,i.__superCtor__=t,i},a=function a(e,t,r){if(1>r.length)return t;var i=r.shift(),n=s(e,t,i);return a(e,n,r)},u=function u(e){var t="",r=Array.prototype.slice.apply(arguments);return"string"==typeof r[0]&&(t=r.shift(),t=t.replace(/\./g,"_")),e=r.shift(),a(t,e,r)},c=function c(){var e=this,t=Array.prototype.slice.apply(arguments),r=[];return"string"==typeof t[0]&&r.push(t.shift()),r.push(e),r=r.concat(t),u.apply(this,r)},h=function h(e,t,r){var i,s,a=typeof r;if("function"===a)s=r.prototype;else{if("object"!==a)throw Error("typeof childCtorOrProto invalid. it should be Function or Object.");s=r}i="function"===a?Function("parent, childCtor","return function "+e+"(){ parent.apply(this, arguments); childCtor.apply(this, arguments)};")(t,r):s&&Object.prototype.hasOwnProperty.call(s,"constructor")?s.constructor:Function("parent","return function "+e+"(){ parent.apply(this, arguments); };")(t),n(i,t);var u=function(){this.constructor=i};u.prototype=t.prototype,i.prototype=new u,s&&n(i.prototype,s);for(var c in t)if(o.test(c)){var h=c.replace("super","supersuper");i[h]=t[c]}return i.__super__=t.prototype,i.__superCtor__=t,i},l=function l(e,t,r){if(1>r.length)return t;var i=r.shift(),n=h(e,t,i);return l(e,n,r)},d=function d(e){var t="",r=Array.prototype.slice.apply(arguments);return"string"==typeof r[0]&&(t=r.shift(),t=t.replace(/\./g,"_")),e=r.shift(),l(t,e,r)},f={extend:u,extendThis:c,mixin:d,VERSION:"0.4.6"};"function"==typeof define&&define.amd?define("beez-core/suns",["require","exports","module"],function(){return f}):"undefined"!=typeof module&&module.exports?module.exports=f:e.suns=f})(this),function(){define("beez-core/error",["require","exports","module","beez-core/suns"],function(e){var t=e("beez-core/suns"),r=t.extend("beez.Error",Error,{constructor:function r(e){Error.apply(this,arguments),Error.captureStackTrace(this,this.constructor),this.message=e}});return r.extend=t.extendThis,r})}(this),function(e){var t=function t(){},r=Array.isArray||function r(e){return"[object Array]"==""+e},i=function i(e){return 0===e.length},n=function n(e){e.stack?console.error(e.stack):e.message?console.error(e.message):console.error(e)},o=0,s=function s(){return"__bucks__"+o++},a=function a(e){this._tasks=[],this._taskcount=0,this._results=[],this.callback=t,this.failure=t,this._alive=!0,this.__id=s(),a.living[this.__id]=this,this.initialize(e)};a.VERSION="0.8.2",a.DEBUG=!1,a.running={},a.living={},a._isOnError=!1,a.onError=function(e){(function(t){a._onError=e,a._isOnError=t})(!0)},a.prototype={initialize:t,_normalizeTask:function(e){var t=e;if(3>e.length)t=function t(t,r,i){var n=e.call(null,t,r);i.call(null,null,n)};else if(3===e.length)t=e;else{if(4!==e.length)throw Error("args length invalid");t=function t(t,r,i,n){e.call(null,t,r,i,n)}}return t},_normalizeSuccess:function(e){var t=e;if(2>e.length)t=function(t,r){var i=e(t);r(null,i)};else{if(2!==e.length)throw Error("args length invalid");t=e}return t},_normalizeError:function(e){var t=e;if(2>e.length||e.length>3)throw Error(e.name+": args length invalid. should be: onError(err, next)");return t},add:function(e){if(!this._alive)throw Error("this bucks object already destroyed.");var t=this._normalizeTask(e);return this._tasks.push(t),this},then:function(e){var t=this._normalizeSuccess(e);return this.add(function(e,r,i){e?i(e):t(r,i)})},empty:function(){return this.then(function(){})},error:function(e){var t=this._normalizeError(e);return this.add(function(e,r,i){e?t(e,i):i(e,r)})},_iterator:function(e,t){if(!this._alive)throw Error("this bucks object already destroyed.");t?this._results.push(t):this._results.push(null);var r=this._tasks.shift();if(!r)return this.destroy(e);try{var i=this;r(e,t,function(e,t){return i._iterator(e,t),this},this._taskcount++)}catch(o){if(!this._results){if(a.DEBUG&&n(o),!a._isOnError)throw o;a._onError(o,this)}this._iterator(o,null)}return this},debug:function(){return this},parallel:function(e){if(!r(e))throw Error("tasks is not array.");if(i(e))return this.add(function(e,t,r){r(null,new u(0).resultObj)});for(var t=0,n=e.length;n>t;t++){var o=e[t];e[t]=this._normalizeTask(o)}return this.add(function(t,r,i){var n=new u(e.length);n.onFinish(function(e){for(var t,r=0,n=e.err.length;n>r;r++){var o=e.err[r];void 0!==o&&null!==o&&(t=o)}i(t,e)}),e.forEach(function(e,t){setTimeout(function(){(new a).add(e).end(function(e,r){e?n.successOne(t,e,null):n.successOne(t,null,r[0])})},0)})})},waterfall:function(e){if(!r(e))throw Error("tasks is not array.");if(i(e))return this.add(function(e,t,r){r(null,[])});for(var t=0,n=e.length;n>t;t++)e[t]=this._normalizeTask(e[t]),this.add(e[t]);return this},delay:function(e){return this.add(function(t,r,i){setTimeout(function(){i(t,r)},e||0)})},dispose:t,destroy:function(e){if(!this._alive)return this;var r=this._results,i=this.callback,o=this.failure,s=this.dispose;this._tasks=null,this._taskcount=0,this._results=null,this.callback=t,this.failure=t,this.dispose=t,r.shift();try{if(i)i(e,r);else if(e)throw e}catch(u){if(o)try{o(u)}catch(c){if(!a._isOnError)throw c;a._onError(c,this)}else{if(a.DEBUG&&n(u),!a._isOnError)throw u;a._onError(u,this)}}finally{try{s.call(this)}catch(c){if(!a._isOnError)throw c;a._onError(c,this)}delete this._alive,delete a.running[this.__id],delete a.living[this.__id],delete this.__id}return this},end:function(e,t){if(e&&1>e.length)throw Error("callback args length invalid. should be `callback(err, ress)` or `callback(err)`.");if(this.callback=e,this.failure=t,!this._tasks||!this._tasks.length){var r=Error("task is empty. add(task) first. if theres no task to execute but end is desired, empty() may be useful");return this.destroy(r,null),e(r)}return a.running[this.__id]=this,this._iterator(),void 0}};var u=function u(e){this._results=[],this._errors=[],this._waiting=e};u.prototype={onFinish:function(e){this._onFinish=e},successOne:function(e,t,r){this._errors[e]=t,this._results[e]=r,this._waiting--,0>=this._waiting&&this._onFinish.call(null,this.resultObj)}},u.prototype.__defineGetter__("resultObj",function(){return{err:this._errors,res:this._results}}),"function"==typeof define&&define.amd?define("beez-core/bucks",["require","exports","module"],function(){return a}):"undefined"!=typeof module&&module.exports?module.exports=a:e.Bucks=a}(this),function(e){var t=function t(){},r=function r(e,t){this.initialize(e,t)};r.prototype={initialize:function(e,r){this.category=e,this.config=r,this.level=this.config.level,this.config.separator&&(this.separator=this.config.separator||" "),this.level===this.LEVELS.TRACE||(this.level===this.LEVELS.DEBUG?this.trace=t:this.level===this.LEVELS.INFO?this.trace=this.debug=t:this.level===this.LEVELS.WARN?this.trace=this.debug=this.info=t:this.level===this.LEVELS.ERROR&&(this.trace=this.debug=this.info=this.warn=t))},LEVELS:{OFF:"OFF",TRACE:"TRACE",DEBUG:"DEBUG",INFO:"INFO",WARN:"WARN",ERROR:"ERROR"},_exclude:function(){if(this.config.excludes&&this.config.excludes.length>0)for(var e=0;this.config.excludes.length>e;e++){var t=RegExp("^"+this.config.excludes[e]);if(this.category.match(t))return!0}return!1},trace:function(){!this._exclude()&&console.debug(this.output("trace",arguments))},debug:function(){!this._exclude()&&console.debug(this.output("debug",arguments))},info:function(){!this._exclude()&&console.info(this.output("info",arguments))},warn:function(){!this._exclude()&&console.warn(this.output("warn",arguments))},error:function(){!this._exclude()&&console.error(this.output("error",arguments))},output:function(e,t){for(var r=Array.prototype.slice.call(t),i=0;r.length>i;i++)if(void 0===r[i])r[i]='"undefined"';else if(null===r[i])r[i]='"null"';else if(r[i]instanceof Error||"Error"===r[i].constructor.name){var n=r[i];r[i]=n.stack?n.stack:n.message}else"object"==typeof r[i]&&(r[i]=r[i].constructor.name+":"+JSON.stringify(r[i]));var o,s,a,u="",c=Error().stack;return c&&(o=c.split("\n"),o[3]?(s=o[3],a=s.indexOf("("),a>=0?(u=s.substring(a),")"!==u.charAt(u.length-1)&&(u="("+u+")")):u="("+s.replace(/[ ]*at /,"")+")"):o[2]&&(s=o[2],a=s.indexOf("@"),a>=0&&(u=s.substring(a+1),u=" ("+u+")"))),"["+e+"]["+this.category+"] "+r.join(this.separator)+" "+u}};var i=function i(e){this.initialize(e)};i.prototype={initialize:function(e){this.config=e,this.loggers={}},setConfigure:function(e){return this.config=e,this},getLogger:function(e){return this.loggers[e]?this.loggers[e]:(this.loggers[e]=new r(e,this.config),this.loggers[e])}},i.VERSION="0.6.7","function"==typeof define&&define.amd?define("beez-core/logcafe",["require","exports","module"],function(){return i}):"undefined"!=typeof module&&module.exports?module.exports=i:e.LogCafe=i}(this),function(e){define("beez.core",["require","exports","module","beez-core/suns","beez-core/error","beez-core/bucks","beez-core/logcafe","backbone","handlebars"],function(t,r,i){var n=e;if(n.beez)return n.beez;var o=t("beez-core/suns"),s=i.config()||{},a=t("beez-core/error"),u=t("beez-core/bucks");u.extend=o.extendThis;var c=t("beez-core/logcafe"),h=new c;h.setConfigure(s.logging||{level:"WARN",separator:" "});var l=function l(e){return h.getLogger(e)},d=l("beez.core.index"),f=function f(t,r,i){t&&(e.onerror=t),r&&u.onError(r),i&&(e.require.onError=i)},g={};if(s.defines&&(g=s.defines,g.globals))for(var p in g.globals)e[p]=g.globals[p],d.debug("Set the value to the global scope.",p,":",e[p]);var m={vendor:{},root:n,global:n,config:s,defines:g,none:function(){},extend:o.extend,extendThis:o.extendThis,mixin:o.mixin,getLogger:l,onError:f,Error:a,Bucks:u};return m.vendor._=m.root._,m.vendor.$=m.root.$,m.vendor.Backbone=t("backbone"),m.vendor.Handlebars=t("handlebars"),n.beez=m,m})}(this),function(e){var t={VERSION:"1.0.2"};t.setup=function(t){if(!t&&e&&e.navigator&&e.navigator.userAgent&&(t=e.navigator.userAgent),!t)throw Error("useragent setup error. useragent not found.");if(this.webkit=t.match(/WebKit\/([\d.]+)/),this.android=t.match(/(Android)\s+([\d.]+)/),this.android23=t.match(/(Android)\s+(2\.3)([\d.]+)/),this.android4=t.match(/(Android)\s+(4)([\d.]+)/),this.ipad=t.match(/(iPad).*OS\s([\d_]+)/),this.iphone=!this.ipad&&t.match(/(iPhone\sOS)\s([\d_]+)/),this.webos=t.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),this.touchpad=this.webos&&t.match(/TouchPad/),this.kindle=t.match(/(Kindle)/),this.silk=t.match(/(Silk)/),this.blackberry=t.match(/(BlackBerry).*/),this.bb10=t.match(/(BB10).*Version\/([\d.]+)/),this.rimtabletos=t.match(/(RIM\sTablet\sOS)\s([\d.]+)/),this.playbook=t.match(/PlayBook/),this.chrome=t.match(/Chrome\/([\d.]+)/)||t.match(/CriOS\/([\d.]+)/),this.firefox=t.match(/Firefox\/([\d.]+)/),this.wii=t.match(/Nintendo (Wii);/),this.ds=t.match(/Nintendo (DS|3DS|DSi);/),this.ps3=t.match(/PLAYSTATION 3/),this.psp=t.match(/(PlayStation Portable)/),this.psvita=t.match(/(PlayStation Vita)/),this.windowsphone=t.match(/(Windows Phone |Windows Phone OS )([\d.]+)/),this.safari=t.match(/(Version)\/([0-9\.]+).*Safari\/([0-9\.]+)/),this.iphone5=!("undefined"!=typeof module&&module.exports)&&this.iphone&&screen&&320===screen.width&&568===screen.height,this.iphone3=this.iphone&&1===e.devicePixelRatio?!0:!1,this.browser={locale:void 0,lang:void 0,country:void 0},this.os={},this.webkit&&(this.browser.webkit=!0,this.browser.version=this.webkit[1]),this.android){this.os.android=!0,this.os.version=this.android[2];try{this.browser.locale=t.match(/(Android)\s(.+);\s([^;]+);/)[3],this.browser.lang=this.browser.locale.substring(0,2),this.browser.country=this.browser.locale.substring(3)}catch(r){}}this.iphone&&(this.os.ios=this.os.iphone=!0,this.os.version=this.iphone[2].replace(/_/g,"."));var i=null;this.os.version&&(i=this.os.version.substring(0,1));for(var n=3;10>n;n++)this["ios"+n]=i===""+n;this.ipad&&(this.os.ios=this.os.ipad=!0,this.os.version=this.ipad[2].replace(/_/g,".")),this.webos&&(this.os.webos=!0,this.os.version=this.webos[2]),this.touchpad&&(this.os.touchpad=!0),this.blackberry&&(this.os.blackberry=!0),this.bb10&&(this.os.bb10=!0,this.os.version=this.bb10[2]),this.rimtabletos&&(this.os.rimtabletos=!0,this.os.version=this.rimtabletos[2]),this.playbook&&(this.browser.playbook=!0),this.kindle&&(this.os.kindle=!0),this.silk&&(this.browser.silk=!0),!this.silk&&this.os.android&&t.match(/Kindle Fire/)&&(this.browser.silk=!0),this.chrome&&(this.browser.chrome=!0,this.browser.version=this.chrome[1]),this.firefox&&(this.browser.firefox=!0,this.browser.version=this.firefox[1]),(this.wii||this.ds)&&(this.os.nintendo=!0),this.windowsphone&&(this.browser.windowsphone=!0,this.browser.version=this.windowsphone[2]),this.safari&&(this.browser.safari=!0,this.browser.version=this.safari[2]),this.os.tablet=!!(this.ipad||this.kindle||this.playbook||this.android&&!t.match(/Mobile/)||this.firefox&&t.match(/Tablet/)),this.os.phone=!(this.os.tablet||!(this.android||this.iphone||this.webos||this.blackberry||this.bb10||this.chrome&&t.match(/Android/)||this.chrome&&t.match(/CriOS\/([\d.]+)/)||this.firefox&&t.match(/Mobile/)||this.windowsphone&&t.match(/IEMobile/)))},"function"==typeof define&&define.amd?define("beez.ua",["require","exports","module"],function(){return t}):"undefined"!=typeof module&&module.exports?module.exports=t:(e.beez||(e.beez={}),e.beez.ua=t)}(this),function(){define("beez-utils/browser",["require","exports","module","beez.core","backbone","beez.ua"],function(e){var t=e("beez.core"),r=t.global||r;t.vendor._;var i=t.vendor.$,n=e("backbone"),o=t.Bucks.extend("beez.utils.BrowserAsync",{initialize:function(e){this.browser=e},dispose:function(){delete this.browser},hideAddress:function(e){return e=e||100,this.delay(e).then(function(){window.scroll(0,0)})}}),s={_prevOrientation:r.orientation,_initOrientation:r.orientation,initialize:function(){this.startHandleOrientation()},startHandleOrientation:function(){var e="onorientationchange"in window?"orientationchange":"resize",t=this;i(r).on(e,function(){var e=r.orientation;t._prevOrientation!==e&&(t.trigger("change:orientation",{prev:t._prevOrientation,current:e,init:t._initOrientation===e?!0:!1}),t._prevOrientation=e)})},getComputedStyle:function(e){return document.defaultView.getComputedStyle(e,"")},async:function(){return new o(this)},hideAddress:function(e){return new o(this).hideAddress(e)},getWindowSize:function(){return{width:window.innerWidth,height:window.innerHeight}},ua:{},getLanguage:function(){var e=navigator.language||navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage;return this.ua.android23&&a.browser.lang?a.browser.lang:e?e.substr(0,2):void 0}},a=e("beez.ua");a.setup(),s.ua=a;var u=t.extend("beez.utils.Browser",function u(){},n.Events,s);return u})}(this),function(){define("beez-utils/uid",["require","exports","module"],function(){var e,t=function(){return e?e:e=this};return t.prototype.create=function(){var e=Math.floor(1e3*Math.random()),t=Date.now();return e+"_"+(""+t)},t})}(this),function(){define("beez-utils/timer",["require","exports","module","beez.core","beez-utils/uid"],function(e){var t=e("beez.core"),r=t.vendor._;t.getLogger("timer");var i=e("beez-utils/uid"),n=new i,o="beez_utils_timer_id",s=function(){this.running=!1,this._callbacks={},this._timerId=0};return s.prototype={addTimeout:function(e,t,i){var s=n.create();e[o]=s;var a={timer_id:s,callback:e,interval:t,time:Date.now()+t,context:i,type:"timeout",canceller:function(){this.type="canceled"}};return r.bindAll.apply(this,[a].concat(r.methods(a))),this._callbacks[s]=a,this.start(),s},addInterval:function(e,t,i){var s=n.create();e[o]=s;var a={timer_id:s,callback:e,interval:t,time:Date.now()+t,context:i,type:"interval",canceller:function(){this.type="canceled"}};return r.bindAll.apply(this,[a].concat(r.methods(a))),this._callbacks[s]=a,this.start(),s},clearInterval:function(e){var t;t="function"==typeof e&&e[o]?e[o]:e;var r=this._callbacks[t];if(!r)throw Error("no callback to clear");r.canceller()},clearTimeout:function(e){var t;t="function"==typeof e&&e[o]?e[o]:e;var r=this._callbacks[t];r&&r.canceller()},_tick:function(){var e=Date.now(),t=this;r.each(this._callbacks,function(r){return e>r.time&&("canceled"!==r.type&&(r.context?r.callback.call(null,r.context):r.callback.call()),"interval"!==r.type&&delete t._callbacks[r.timer_id],r.time=e+r.interval),!0}),r.keys(this._callbacks).length||this.stop()},start:function(){if(!this.running){this.running=!0;var e=this,t=function t(){e.running&&(e._tick(),e._timerId=setTimeout(t,100))};t()}},stop:function(){this.running=!1,clearTimeout(this._timerId)}},s})}(this),function(e){define("beez.utils",["require","exports","module","beez.core","beez-utils/browser","beez-utils/timer"],function(t){var r=t("beez.core"),i=r.vendor._,n=r.getLogger("beez.utils");if(r.utils)return n.warn("beez.utils already defined."),r.utils;var o={initialize:function(){var i=t("beez-utils/browser"),n=t("beez-utils/timer");this.browser=new i,this.Timers=n,this.none=r.none,this.pixelRatio=e.devicePixelRatio||1},copyr:function s(e,t){for(var r in t){var n=e[r],o=t[r];i.isObject(n)&&!i.isArray(o)?s(e[r],t[r]):e[r]=t[r]}return e},is:function(e,t){var r=Object.prototype.toString.call(t).slice(8,-1);return void 0!==t&&null!==t&&r===e}},a=r.extend("beez.Utils",function(){return this.initialize()},o);return i.each(["Equal","Empty","Element","Arguments","Function","String","Number","Finite","Boolean","Date","RegExp","NaN","Null","Undefined"],function(e){a.prototype["is"+e]=i["is"+e]}),i.each(["Object","Array"],function(e){a.prototype["is"+e]=function(t){return this.is.apply(this,[e,t])}}),r.utils=new a,r.utils})}(this),function(){define("beez.i18n",["require","exports","module","beez.core","beez.utils","handlebars"],function(e){var t=e("beez.core");e("beez.utils");var r=t.getLogger("beez.i18n"),i=t.vendor._;if(t.i18n)return r.warn("beez.i18n is already loaded."),t.i18n;var n={initialize:function(e){this.lang={base:"en",use:void 0},this.message={},this.parseReg=RegExp(/\{#{1}[(0-9a-zA-Z)]*\}/),this.lang.use=t.utils.browser.getLanguage(),e=e||{},e.lang=e.lang||{},e.lang.base&&(this.lang.base=e.lang.base),e.lang.use&&(this.lang.use=e.lang.use),this.lang.use||(this.lang.use=this.lang.base),e.message&&(this.message=e.message)},getCurrentLang:function(){return this.lang.use||this.lang.base},parse:function(e,t){var r=e.split(this.parseReg);if(1===r.length&&""===r[0])return e;var n="";return i.each(r,function(e,r){n+=e+(t[r]||"")}),n},__:function(e){return this.getMessage(e)},getMessage:function(e){var t=this.getCurrentLang();if(this.message[t]||(t=this.lang.base),!this.message[t])return"";var r=this.message[t][e]||"";!r&&this.message[this.lang.base]&&(r=this.message[this.lang.base][e]||"");var i=Array.prototype.slice.call(arguments,1);return this.parse(r,i)},add:function(e){return t.utils.copyr(this.message,e)},addMessage:function(e,r){return this.message[e]=this.message[e]||{},t.utils.copyr(this.message[e],r)},remove:function(e,t){var r=this.message[e];r&&r[t]?this.message[e][t]=null:r?this.message[e]=null:this.message={}},dispose:function(){delete this.lang,delete this.message,delete this.parseReg}},o=t.extend("beez.i18n",function(){return this.initialize.apply(this,arguments)},n);o.extend=t.extendThis,t.I18n=o,t.i18n={setup:function(e,i){return t.i18n.initialize?(r.warn("Setup has already been. beez.i18n"),t.i18n):(delete t.i18n.setup,delete t.i18n,i||(i=o),t.i18n=new i(e),t.i18n)}};var s=e("handlebars");return s.registerHelper("__",function(){if(t.i18n){var e=Array.prototype.slice.call(arguments,0,arguments.length-1);return new s.SafeString(t.i18n.getMessage.apply(t.i18n,e))}return""}),s.registerHelper("__e",function(){if(t.i18n){var e=Array.prototype.slice.call(arguments,0,arguments.length-1);return t.i18n.getMessage.apply(t.i18n,e)}return""}),t.I18n})}(this),function(global){define("beez-mvcr/jsonpath",["require","exports","module","beez.core"],function(require,exports,module){var beez=require("beez.core"),_=beez.vendor._,cache={},jsonPath=function jsonPath(obj,expr,arg,testManaged){var P={resultType:arg&&arg.resultType||"VALUE",flatten:arg&&arg.flatten||!1,wrap:arg&&arg.hasOwnProperty("wrap")?arg.wrap:!0,normalize:function(e){if(cache[e])return cache[e];var t=[],r=e.replace(/[\['](\??\(.*?\))[\]']/g,function(e,r){return"[#"+(t.push(r)-1)+"]"}).replace(/'?\.'?|\['?/g,";").replace(/;;;|;;/g,";..;").replace(/;$|'?\]|'$/g,"").replace(/#([0-9]+)/g,function(e,r){return t[r]});return cache[e]=r,r},asPath:function(e){for(var t=e.split(";"),r="$",i=1,n=t.length;n>i;i++)r+=/^[0-9*]+$/.test(t[i])?"["+t[i]+"]":"['"+t[i]+"']";return r},store:function(e,t){return e&&("PATH"===P.resultType?P.result[P.result.length]=P.asPath(e):_.isArray(t)&&P.flatten?(P.result||(P.result=[]),_.isArray(P.result)||(P.result=[P.result]),P.result=P.result.concat(t)):P.result?(_.isArray(P.result)||(P.result=[P.result]),_.isArray(t)&&P.flatten?P.result=P.result.concat(t):P.result[P.result.length]=t):P.result=t),!!e},trace:function(e,t,r){if(e){var i=e.split(";"),n=i.shift();if(i=i.join(";"),t&&t.hasOwnProperty(n))P.trace(i,t[n],r+";"+n);else if("*"===n)P.walk(n,i,t,r,function(e,t,r,i,n){P.trace(e+";"+r,i,n)});else if(".."===n)P.trace(i,t,r),P.walk(n,i,t,r,function(e,t,r,i,n){"object"==typeof i[e]&&P.trace("..;"+r,i[e],n+";"+e)});else if(/,/.test(n))for(var o=n.split(/'?,'?/),s=0,a=o.length;a>s;s++)P.trace(o[s]+";"+i,t,r);else/^\(.*?\)$/.test(n)?P.trace(P.evaluate(n,t,r.substr(r.lastIndexOf(";")+1))+";"+i,t,r):/^\?\(.*?\)$/.test(n)?P.walk(n,i,t,r,function(e,t,r,i,n){P.evaluate(t.replace(/^\?\((.*?)\)$/,"$1"),i[e],e)&&P.trace(e+";"+r,i,n)}):/^(-?[0-9]*):(-?[0-9]*):?([0-9]*)$/.test(n)&&P.slice(n,i,t,r)}else t&&(_.isArray(t)||testManaged(t))&&P.store(r,t)},walk:function(e,t,r,i,n){if(r instanceof Array)for(var o=0,s=r.length;s>o;o++)o in r&&n(o,e,t,r,i);else if("object"==typeof r&&testManaged(r))for(var a in r)r.hasOwnProperty(a)&&n(a,e,t,r,i)},slice:function(e,t,r,i){if(r instanceof Array){var n=r.length,o=0,s=n,a=1;e.replace(/^(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)$/g,function(e,t,r,i){o=parseInt(t||o,10),s=parseInt(r||s,10),a=parseInt(i||a,10)}),o=0>o?Math.max(0,o+n):Math.min(n,o),s=0>s?Math.max(0,s+n):Math.min(n,s);for(var u=o;s>u;u+=a)P.trace(u+";"+t,r,i)}},evaluate:function(x,_v,_vname){try{return $&&_v&&eval(x)}catch(e){throw new SyntaxError("jsonPath: "+e.message+": "+x.replace(/\^/g,"_a"))}}};P.result=P.wrap===!0?[]:void 0;var $=obj;return expr&&obj&&("VALUE"===P.resultType||"PATH"===P.resultType)?(P.trace(P.normalize(expr).replace(/^\$;/,""),obj,"$"),!_.isArray(P.result)&&P.wrap&&(P.result=[P.result]),P.result?P.result:!1):void 0};return jsonPath})}(this),function(){define("beez-mvcr/base",["require","exports","module","beez.core","beez-mvcr/jsonpath"],function(e){var t=e("beez.core"),r=t.vendor._,i=e("beez-mvcr/jsonpath"),n=t.getLogger("beez.mvcr.base"),o=t.extend("beez.manager.ManagerBase",function o(){},{constructor:function(e){this.objs={},this.objs[e]="$",this._idxProp=e||"",this.initialize.apply(this,arguments)},initialize:function(){},getIdx:function(e){return e[this._idxProp]},add:function(e,i){var n=this.get(e);if(!n)throw new t.Error("no parent exists. path: "+e);if(r.isArray(n))throw new t.Error("parent is Array. Specify one by using `[number]` selector. parent: "+n);if(r.isArray(i))r.each(i,function(t){t.prefix=e;var r=this.getIdx(t);n[r]||(n[r]=[]),n[r].push(t)},this);else{i.prefix=e;var o=this.getIdx(i);if(n[o])throw new t.Error("Obj: adding object to same parent with same index. Add obj as Array to add several objs into same index. idx: "+this.getIdx(i));n[o]=i}return this},remove:function(e){var t,i=this.get(e),n=[];i&&(r.isArray(i)||(i=[i]),r.each(i,function(e){var t=this.getChildrenAll(e);n=n.concat(t)},this),t=n.concat(i),r.each(t,function(e){this.deleteFromParent(e)},this),r.each(t,function(e){e.dispose&&e.dispose()}))},isAddable:function(e){return!!this.getIdx(e)},get:function(e){if(void 0===e||"string"!=typeof e)return void 0;if(/^\/$/.test(e))return this.objs;var t=this;e="$"+e.replace(/\//g,".");var r=i(this.objs,e,{wrap:!1},function(e){return t.isAddable(e)});return r?r:void 0},getParent:function(e){return r.isArray(e)?this.get(e[0].prefix):this.get(e.prefix)},deleteFromParent:function(e){if(e){var t=this.getParent(e);r.isArray(e)?delete t[this.getIdx(e[0])]:delete t[this.getIdx(e)]}},getChildren:function(e){var t=[],i=this,n=function n(e){r.each(e,function(e){e&&(r.isArray(e)?n(e):i.getIdx(e)&&t.push(e))})};return n(e),t},getChildrenAll:function(e){var t=[],i=this,o=function o(e){var s=e;r.isArray(e)||(s=r.values(e)),r.each(s,function(s){if(s)if(r.isArray(s))o(s);else if(i.getIdx(s)){if(!s.prefix||!s.manager)return n.warn("Manager ignore the Object haven't been manaegd.",s),void 0;if("$"!==e[i._idxProp]&&!r.isArray(e)&&s.getParent()[i._idxProp]!==e[i._idxProp])return n.warn("Manager ignore the Object haven't been manaegd.","Path that is managed:",i.pathOf(s),"Path to the specified:",i.pathOf(e)),void 0;o(s),t.push(s)}})};return o(e),t},pathOf:function(e){var i="";if(r.isArray(e)){if(r.isEmpty(e))throw new t.Error("pathOf: obj is empty array.");e=e[0]}if(i=e.prefix,!i)throw new t.Error("pathOf: object.prefix does not exist.");return i+(/^\/$/.test(i)?"":"/")+this.getIdx(e)},trace:function(){var e={},t=this.getChildrenAll(this.objs||{}),i=this;return r.each(t,function(t){if(t){var n;n="/"===t.prefix?t.prefix+i.getIdx(t):t.prefix+"/"+i.getIdx(t),e[n]?(r.isArray(e[n])||(e[n]=[e[n]]),e[n].push(t)):e[n]=t}}),e},dispose:function(){delete this.objs,delete this._idxProp}}),s=t.extend("beez.mvcr.Base",function s(){},{getParent:function(){return this.manager.getParent(this)},deleteFromParent:function(){return this.manager.deleteFromParent(this)},getChildren:function(){return this.manager.getChildren(this)},getChildrenAll:function(){return this.manager.getChildrenAll(this)},alias:function(e){return this.manager.add(e,this)}});return{ManagerBase:o,Base:s}})}(this),function(){define("beez-mvcr/model",["require","exports","module","beez.core","backbone","beez-mvcr/base"],function(e){var t=e("beez.core"),r=t.vendor._,i=e("backbone"),n=t.vendor.$,o=e("beez-mvcr/base"),s=o.Base,a=o.ManagerBase,u=t.getLogger("beez.mvcr.model"),c=t.Bucks.extend("beez.mvcr.ModelManagerAsync",{initialize:function(e){this.manager=e,this.current=void 0,this.root=void 0},create:function(e,r,i,n){var o=this;return this.then(function(){var s=o.manager.create(e,r,i,n);return o.root=o.current=s,o.create=function(){throw new t.Error("create called more than once!")},s})},createCollection:function(e,r,i,n){var o=this;return this.then(function(){var s=o.manager.createCollection(e,r,i,n);return o.root=o.current=s,o.createCollection=function(){throw new t.Error("create called more than once!")},s})},child:function(e,i,n){var o=this;return this.then(function(){if(!o.root)throw new t.Error("No chain root exists. `create` first.");var s=o.manager.pathOf(o.current),a=o.manager.create(s,e,i,n);o.current=r.isArray(a)?a[0]:a})},parent:function(){var e=this;return this.then(function(){if(e.current=e.manager.getParent(e.current),!e.current)throw new t.Error("get parent failed")})},bro:function(e,t,r){return this.parent().child(e,t,r)},dispose:function(){u.trace(this.constructor.name,"dispose"),delete this.manager,delete this.current,this.root&&this.root.dispose&&this.root.dispose(),delete this.root}}),h=t.extend("beez.mvcr.ModelManager",a,{initialize:function(){h.__super__.initialize.apply(this,arguments)},async:function(){return new c(this)},root:function(e){var r=new e(this),i=this.get("/@");if(i)throw new t.Error("root already exists!");if("@"!==r.midx)throw new t.Error('roots midx must be "@"');return this.add("/",r),r},create:function(e,i,n,o){if(!i||!r.isArray(i)&&"function"!=typeof i){var s="Model does not exist / does not be funciton. Specified prefix: "+e;throw new t.Error(s)}if(i instanceof g)throw new t.Error("Collection specified.  Use #createCollection instead.");if(!e)throw new t.Error("No prefix specified. Creating:"+i.name);if(0>e.indexOf("/@"))throw new t.Error('prefix must started by "/@". Creating:'+i.name);if(!this.get(e))throw new t.Error("no parent exists. prefix: "+e+" ,  Please consider constructing in Controller and so on.");return r.isArray(i)?this._createArray(e,i,n,o):this._createObj(e,i,n,o)},_createObj:function(e,r,i,n){var o=new r(i,n,this);if(!this.isAddable(o))throw new t.Error("index does not exists in the Model. :"+o);return this.add(e,o),o},_createArray:function(e,i,n,o){n&&!r.isArray(n)&&(n=[n]),o&&!r.isArray(o)&&(o=[o]);var s=this,a=[];return r.each(i,function(e,t){var r=n?n[t]:void 0,i=o?o[t]:void 0;a.push(new e(r,i,s))}),r.each(a,function(e){if(!this.isAddable(e))throw new t.Error("index does not exist in the Model. :"+e)},this),this.add(e,a),a},createCollection:function(e,r,i,n){if(!r||"function"!=typeof r){var o="Collection does not exist / does not be funciton. Specified prefix: "+e;throw new t.Error(o)}if(!e)throw new t.Error("No prefix specified. Creating:"+r.name);if(0>e.indexOf("/@"))throw new t.Error('prefix must started by "/@". Creating:'+r.name);var s=new r(i,n,this);return this.add(e,s),s},_newAll:function(e,i,n){if(!e)throw new t.Error("ctor does not exist.");r.isArray(e)||(e=[e]),i&&!r.isArray(i)&&(i=[i]),n&&!r.isArray(n)&&(n=[n]);var o=[];return r.each(e,function(e,t){var r=i?i[t]:void 0,s=n?n[t]:void 0;o.push(new e(r,s))}),o},_decideBindedModel:function(e,i){var n,o,s;if(i)o=e;else{n=e,s=[],r.each(n,function(e){var t=this.getChildrenAll(e);s=s.concat(t)},this);var a=s.concat(n),u=r.reject(a,function(e){return e.isBinded()}),c=r.difference(a,u);r.each(c,function(e){throw new t.Error("a disposing model have some bindings. models cid: "+e.cid)}),o=u}return o},remove:function(e,t){var i=this.get(e);return i?(u.debug(this.constructor.name,"remove. path:",e),i.isCollection()?(this._decideBindedModel(i,!0).removeAll&&this._decideBindedModel(i,!0).removeAll(t),this.deleteFromParent(i),this):(i&&!r.isArray(i)&&(i=[i]),r.each(this._decideBindedModel(i),function(e){this.deleteFromParent(e)},this),r.each(this._decideBindedModel(i),function(e){e.dispose&&e.dispose()}),this)):(u.debug("Path of unmanaged become subject to deletion, I was skipped. path:",e),this)},ajax:function(e){var i=e.type,o=t.config.ajax||{},s=t.config.url&&t.config.url.api;if(r.defaults(e||(e={}),o,{dataType:"json",contentType:"application/json",emulateHTTP:!1,emulateJSON:!1,urlRoot:s||""}),/^(http|https):\/\//.test(e.url)||(e.url=e.urlRoot+e.url),e.data&&e.contentType&&0===e.contentType.indexOf("application/json")&&(e.data=JSON.stringify(e.data)),e.emulateJSON&&(e.contentType="application/x-www-form-urlencoded"),"GET"===e.type||e.emulateJSON||(e.processData=!1),e.emulateHTTP&&("PUT"===i||"DELETE"===i||"PATCH"===i)){e.type="POST",e.emulateJSON&&(e.data._method=i);var a=e.beforeSend;e.beforeSend=function(t){!e.emulateHTTP||"PUT"!==i&&"DELETE"!==i&&"PATCH"!==i||t.setRequestHeader("X-HTTP-Method-Override",i),a&&a.apply(null,arguments)}}return n.ajax.call(null,e)},$get:function(e){return r.extend(e||(e={}),{type:"GET"}),this.ajax(e)},$post:function(e){return r.extend(e||(e={}),{type:"POST"}),this.ajax(e)},$put:function(e){return r.extend(e||(e={}),{type:"PUT"}),this.ajax(e)},$delete:function(e){return r.extend(e||(e={}),{type:"DELETE"}),this.ajax(e)
},$patch:function(e){return r.extend(e||(e={}),{type:"PATCH"}),this.ajax(e)},dispose:function(){u.trace(this.constructor.name,"dispose");var e=this.getChildrenAll(this.objs);r.each(e,function(e){e.dispose()}),delete this.urlRoot,h.__super__.dispose.apply(this,arguments)}}),l=t.Bucks.extend("beez.mvcr.ModelAsync",{initialize:function(e){this.model=e},fetch:function(e){var t=this.model;return this.then(function(i,n){e=e?r.clone(e):{},e.success=function(e,t){n(null,{model:e,res:t})},e.error=function(t,r){n(Error(JSON.stringify({model:t,res:r,options:e})))},t.fetch(e)})},save:function(e,t,i){var n;null==e||r.isObject(e)?(n=e,i=t):null!=e&&((n={})[e]=t);var o=this.model;return this.then(function(e,t){i=i?r.clone(i):{},i.success=function(e,r){t(null,{model:e,res:r})},i.error=function(e,r){t(Error(JSON.stringify({model:e,res:r,options:i})))},o.save(n,i)})},destroy:function(e){var t=this.model;return this.then(function(i,n){e=e?r.clone(e):{},e.success=function(e,t){n(null,{model:e,res:t})},e.error=function(t,r){n(Error(JSON.stringify({model:t,res:r,options:e})))},t.destroy(e)})},dispose:function(){u.trace(this.constructor.name,"dispose"),delete this.model}}),d=t.extend("beez.mvcr.Model",s,i.Model.prototype,{constructor:function(e,i){var n=Array.prototype.slice.call(arguments);i=i||{};var o="";i.urlRoot?o=i.urlRoot:t.config&&t.config.url&&(o=t.config.url.api||""),i.urlRoot=o,r.extend(this,r.pick(i,["urlRoot"])),(1===n.length&&n[0].objs||2===n.length&&n[1].objs||3===n.length&&n[2].objs)&&(this.manager=n[n.length-1]),this.manager||u.debug("Manager can't be managed this model."),d.__super__.constructor.call(this,e,i)},initialize:function(){d.__super__.initialize.apply(this,arguments)},midx:void 0,async:function(){return new l(this)},isCollection:function(){return!1},isModel:function(){return!0},isBinded:function(){if(this._events){var e,t,i,n,o;for(n=r.keys(this._events),e=0,t=n.length;t>e;e++)if(i=n[e],o=this._events[i],o&&o.length>0)return!0}return!1},dispose:function(){u.trace(this.constructor.name,"dispose"),delete this.manager,delete this.cid,delete this.attributes,delete this.collection},remove:function(){throw new t.Error("Use Backbone.model.destroy() or Model.dipose() instead of this")}});d.extend=t.extendThis;var f=t.Bucks.extend("beez.mvcr.CollectionAsync",{initialize:function(e){this.collection=e},create:function(e,t){var r=this;return this.then(function(){return r.collection.create(e,t)})},remove:function(e,t){var r=this;return this.then(function(){return r.collection.remove(e,t)})},_reset:function(){var e=this;return this.then(function(){return e.collection._reset()})},dispose:function(){u.trace(this.constructor.name,"dispose"),delete this.collection}}),g=t.extend(s,i.Collection.prototype,{constructor:function(e,r,i){this.model||(this.model=d),this.urlRoot=function(){var e="";return t.config&&t.config.url&&(e=t.config.url.api||""),e}(),this.manager=i;var n=arguments;arguments.length>=3&&(n=Array.prototype.slice.call(arguments,0,arguments.length-1)),g.__super__.constructor.apply(this,n)},initialize:function(){g.__super__.initialize.apply(this,arguments)},midx:void 0,async:function(){return new f(this)},isCollection:function(){return!0},isModel:function(){return!1},remove:function(e){return g.__super__.remove.apply(this,arguments),e=r.isArray(e)?e.slice():[e],r.each(e,function(e){e.dispose&&e.dispose()}),this},removeAll:function(e){return this.remove(this.models,e)},_reset:function(){this.length=0,r.each(this.models,function(e){e.dispose&&e.dispose()}),this.models=[],this._byId={}},isBinded:function(){if(this._events){var e,t,i,n,o;for(n=r.keys(this._events),e=0,t=n.length;t>e;e++)if(i=n[e],o=this._events[i],o&&o.length>0)return!0}return!1},dispose:function(){u.trace(this.constructor.name,"dispose"),r.each(this.models,function(e){e.dispose&&e.dispose()}),delete this.manager,delete this.comparator,delete this.length,delete this.models,delete this._byId}});return g.extend=t.extendThis,{Model:d,Collection:g,ModelManager:h,ModelManagerAsync:c}})}(this),function(){define("beez-mvcr/modic",["require","exports","module","beez.core","backbone","beez-mvcr/model"],function(e){var t=e("beez.core");t.vendor._,e("backbone");var r=e("beez-mvcr/model"),i=r.Model.extend("beez.mvcr.Modic",{midx:void 0,lRoot:function(){throw new t.Error("not allowed to use this function.")},url:function(){throw new t.Error("not allowed to use this function.")},async:function(){throw new t.Error("not allowed to use this function.")},fetch:function(){throw new t.Error("not allowed to use this function.")},save:function(){throw new t.Error("not allowed to use this function.")}});return{Modic:i}})}(this),function(){define("beez-mvcr/view",["require","exports","module","beez.core","backbone","beez-mvcr/base"],function(e){var t=e("beez.core"),r=t.vendor._,i=e("backbone"),n=e("beez-mvcr/base"),o=n.Base,s=n.ManagerBase,a=t.getLogger("beez.mvcr.view"),u=t.Bucks.extend("beez.mvcr.ViewManagerAsync",{initialize:function(e){this.manager=e},root:function(e){var t=this;return this.then(function(){return t.manager.root(e)})},create:function(e,t,i){var n=this;return this.then(function(){var o=n.manager.create(e,t,i),s=r.isArray(o)?o[0]:o;return s})},child:function(e,t){var i=this;return this.then(function(n){var o=i.manager.pathOf(n),s=i.manager.create(o,e,t);return n=r.isArray(s)?s[0]:s})},parent:function(){var e=this;return this.then(function(r){var i=e.manager.getParent(r);if(i)throw new t.Error("get parent failed. current: "+r);return r=i})},bro:function(e,t){return this.parent().child(e,t)},dispose:function(){a.trace(this.constructor.name,"dispose"),delete this.manager,delete this.current,delete this.root}}),c=t.extend("beez.mvcr.ViewManager",s,{initialize:function(){c.__super__.initialize.apply(this,arguments)},async:function(){return new u(this)},root:function(e){this.add("/",new function(){this.vidx="@"});var r=new e(this),i=this.getChildren(this.get("/@"));this.remove("/@");var n=this.get("/@");if(n)throw new t.Error("root already exists!");if("@"!==r.vidx)throw new t.Error('roots vidx must be "@"');this.add("/",r);for(var o=0;i.length>o;o++)this.add("/@",i[o]);return r},create:function(e,i,n){if(!i||!r.isArray(i)&&"function"!=typeof i)throw new t.Error("View does not exist / does not be funciton. Specified prefix: "+e);if(!e)throw new t.Error("No prefix specified. Creating:"+i.name);if(0>e.indexOf("/@"))throw new t.Error('prefix must started by "/@". Creating:'+i.name);if(!this.get(e))throw new t.Error("no parent exists. prefix: "+e+" ,  Please consider constructing view in Controller, or in #beforeOnce and so on.");return r.isArray(i)?this._createArray(e,i,n):this._createObj(e,i,n)},_createObj:function(e,r,i){var n=new r(this,i);if(!this.isAddable(n))throw new t.Error("index does not exists in the View. :"+n);return this.add(e,n),n},_createArray:function(e,i,n){var o=this;n&&!r.isArray(n)&&(n=[n]);var s=[];return r.each(i,function(e,t){var r=n?n[t]:void 0,i=new e(o,r);s.push(i)}),r.each(s,function(e){if(!this.isAddable(e))throw new t.Error("index does not exists in the View. :"+e)},this),this.add(e,s),s},remove:function(){c.__super__.remove.apply(this,arguments)},dispose:function(){a.trace(this.constructor.name,"dispose");var e=this.getChildrenAll(this.objs);r.each(e,function(e){e.dispose()}),c.__super__.dispose.apply(this,arguments)}}),h=t.Bucks.extend("beez.mvcr.ViewAsync",{initialize:function(e){this._root=e},_render:function(e){return this.then(function(){return e}),e.state.isBeforeOnce||this.then(function(e,t){return e.visible?e.beforeOnce.length?(e.beforeOnce(function(){e.state.isBeforeOnce=!0,t(null,e)}),void 0):(e.beforeOnce(),e.state.isBeforeOnce=!0,t(null,e),void 0):(a.debug("view",e.vidx,"is not visible. skip `beforeOnce`."),t(null,e),void 0)}),this.then(function(e,t){return e.visible?e.before.length?(e.before(function(){t(null,e)}),void 0):(e.before(),t(null,e),void 0):(a.debug("view",e.vidx,"is not visible. skip `before`."),t(null,e),void 0)}),this.then(function(e,t){return e.visible?e.render.length?(e.render(function(){t(null,e)}),void 0):(e.render(),t(null,e),void 0):(a.debug("view",e.vidx,"is not visible. skip `render`."),t(null,e),void 0)}),this.then(function(e,t){return e.visible?e.after.length?(e.after(function(){t(null,e)}),void 0):(e.after(),t(null,e),void 0):(a.debug("view",e.vidx,"is not visible. skip `after`."),t(null,e),void 0)}),e.state.isAfterOnce||this.then(function(e,t){return e.visible?e.afterOnce.length?(e.afterOnce(function(){e.state.isAfterOnce=!0,t(null,e)}),void 0):(e.afterOnce(),e.state.isAfterOnce=!0,t(null,e),void 0):(a.debug("view",e.vidx,"is not visible. skip `afterOnce`."),t(null,e),void 0)}),this},_remove:function(e){return this.then(function(){return e.remove(),e})},show:function(e){if(!this._root)throw new t.Error("render root is not set. initialize renderer with root view parameter.");return this._show(this._root,e)},_show:function(e,t){if(void 0===t&&(t=!0),r.isArray(e)){if(r.isEmpty(e))return this;e.sort(function(e,t){return e.order<t.order?-1:e.order>t.order?1:0});var i=r.map(e,function(e){return function(r,i,n){if(r)throw r;(new h)._show(e,t).end(function(e){n(e,void 0)})}});this.waterfall(i)}else a.debug("showing",e.vidx),this._render(e,t);return t&&this.then(function(e,i){if(!e)return i(null,e);var n=e.getChildren();return r.isEmpty(n)?i(null,e):(new h)._show(n,t).end(i)}),this},hide:function(e){if(!this._root)throw new t.Error("render root is not set. initialize renderer with root view parameter.");return this._hide(this._root,e)},_hide:function(e,t){if(void 0===t&&(t=!0),r.isArray(e)){var i=r.map(e,function(e){return function(r,i,n){if(r)throw r;(new h)._hide(e,t).end(function(e){n(e,void 0)})}});this.waterfall(i)}else a.debug("hiding",e.vidx),this._remove(e);return t&&this.then(function(e,i){if(!e)return i(null,e);var n=e.getChildren();return r.isEmpty(n)?i(null,e):(new h)._hide(n,t).end(i)}),this},dispose:function(){a.trace(this.constructor.name,"dispose"),delete this._root}}),l=t.extend("beez.mvcr.View",o,i.View.prototype,{constructor:function(){if(1>arguments.length)throw new t.Error("In order to create a View, requires one arguments.");this.manager=arguments[0],this.state={isBeforeOnce:!1,isAfterOnce:!1},this.visible=!0,l.__super__.constructor.apply(this,Array.prototype.slice.call(arguments,1))},initialize:function(){l.__super__.initialize.apply(this,arguments)},vidx:void 0,el:void 0,order:0,beforeOnce:t.none,before:t.none,after:t.none,afterOnce:t.none,async:function(){return new h(this)},isRendered:function(){return!!this.el&&!!this.el.parentElement},setVisible:function(e){if("boolean"!=typeof e)throw t.Error("typeof visible invalid. should be boolean.");return this.visible=e,this},dispose:function(){a.trace(this.constructor.name,"dispose"),this.remove(),l.__super__.undelegateEvents.apply(this,arguments),delete this.manager,delete this.state,delete this.visible,delete this.cid,delete this.options,delete this.$el,delete this.model,delete this.collection,delete this.el,delete this.attributes,delete this.className,delete this.tagName},remove:function(){l.__super__.remove.apply(this,arguments)}});return l.extend=t.extendThis,{View:l,ViewAsync:h,ViewManager:c,ViewManagerAsync:u}})}(this),function(){define("beez-mvcr/controller",["require","exports","module","beez.core","beez.mvcr","beez.i18n"],function(e){var t=e("beez.core");e("beez.mvcr"),e("beez.i18n");var r=t.getLogger("beez.mvcr.controller"),i=t.vendor._,n=t.Bucks.extend("beez.mvcr.ControllerManagerAsync",{initialize:function(e){this.manager=e},create:function(e,i){var n=this;return this.then(function(r,o){if(!i||"function"!=typeof i)throw new t.Error("Controller does not exist / does not be funciton. Specified name: "+e);if(n.manager.controllers[e])throw new t.Error("It is a singleton in the module. name:"+e);var s=new i;n.manager.controllers[e]=s,o(r,n.manager.controllers[e])}).then(function(e,t){e.loadCSS(function(){t(null,e)})}).then(function(e,t){e.loadI18n(function(i){i&&(r.error("i18n load error. ",i.message),r.debug(i.stack)),t(i,e)})})},dispose:function(){r.trace(this.constructor.name,"dispose"),delete this.manager}}),o=t.extend("beez.mvcr.ControllerManager",function(){return this.initialize()},{initialize:function(){this.controllers={}},async:function(){return new n(this)},remove:function(e){var t=this.get(e);return t?(delete this.controllers[e],this):this},get:function(e){return this.controllers[e]},dispose:function(){r.trace(this.constructor.name,"dispose"),delete this.controllers}}),s=t.extend("beez.mvcr.Controller",function(){this.initialize.apply(this,arguments)},{initialize:function(){},i18n:function(){},loadI18n:function(n){t.i18n||t.createI18n();var o=this;if(t.utils.is("Object",this.i18n)){var s=[],a=[];i.each(this.i18n,function(e,t){s.push(t),a.push(e)}),e(a,function(){for(var e=Array.prototype.slice.call(arguments),i=0;e.length>i;i++){var o={};o[s[i]]=e[i],t.i18n.add(o),r.debug("i18n file loaded. path:",a[i])}n&&n(null)},function(e){n&&n(e)})}else t.utils.is("Function",this.i18n)?(new t.Bucks).add(function(e,t,r){o.i18n.length>0?o.i18n(function(e,t){r(e,t)}):r(null,o.i18n())}).add(function(e,r){r&&t.i18n.add(r),n&&n(e,r)}).end():n&&n(Error("The Controller.i18n, please be defined in Function."));return this},loadCSS:function(e){var r=this.css;if(!r||1>r.length)return e&&e();var n=i.map(r,function(e){return function(r,i,n){t.manager.css.async().load(e).end(function(e,t){n(r,t[0])},function(e){n(e)})}}),o=new t.Bucks;return o.parallel(n).end(function(t,r){e&&e(t,r)}),this},dispose:function(){r.trace(this.constructor.name,"dispose"),delete this.constructor.prototype.css}});return s.extend=t.extendThis,{Controller:s,ControllerManager:o,ControllerManagerAsync:n}})}(this),function(){define("beez-mvcr/router",["require","exports","module","beez.core","beez.mvcr","backbone"],function(e){var t=e("beez.core");e("beez.mvcr");var r=t.getLogger("beez.mvcr.router"),i=t.vendor._,n=e("backbone"),o={initialize:function(){this.router=void 0,this.setuped=!1},setup:function(n,o){var s=this;if(this.setuped)throw new t.Error("Already been executed once. If you want to add a route, please refer to the function add().");var a=t.config.router||{},u=i.extend(a,n);if(this.router)return this;this.router=o||new t.Router;for(var c=i.keys(u),h=0;c.length>h;h++){var l=c[h],d=u[l];this.router.route(d.route,d.name,function(i){function n(){if(!u.hasOwnProperty(i))throw new t.Error("route map key does not exist. name: "+i);var n=u[i],o=arguments;r.debug("router.proxy",n),t.manager.c.get(n.xpath)||(r.trace("run controller firstBefore function. data:",n),s.router.firstBefore(n)),e([n.require],function(e){r.debug("controller.exec",n.xpath);var i=t.manager.c.get(n.xpath);if(i){if(!i[n.name])throw new t.Error('"'+n.name+'" to Controller I is undefined.');r.trace("run controller before function. data:",n),s.router.before(n,e),i[n.name].apply(i,o),r.trace("run controller after function. data:",n),s.router.after(n,e)}else t.manager.c.async().create(n.xpath,e).then(function(i){if(!i[n.name])throw new t.Error('"'+n.name+'" to Controller I is undefined.');r.trace("run controller before function. data:",n),s.router.before(n,e),i[n.name].apply(i,o),r.trace("run controller after function. data:",n),s.router.after(n,e)}).end()})}return n}(l))}this.setuped=!0},navigate:function(e,r){if(!this.setuped||!this.router)throw new t.Error('Initialization has not been performed even once. Please do a "setup()".');return this.router.navigate(e,r)},dispose:function(){r.trace(this.constructor.name,"dispose"),this.router&&this.router.dispose&&this.router.dispose(),delete this.setuped}},s=t.extend("beez.mvcr.RouterManager",function(){return this.initialize()},o),a=t.extend("beez.mvcr.Router",n.Router,{constructor:function(){a.__super__.constructor.apply(this,arguments)},initialize:function(){a.__super__.initialize.apply(this,arguments)},firstBefore:function(){},before:function(){},after:function(){},dispose:function(){r.trace(this.constructor.name,"dispose")}});return{Router:a,RouterManager:s}})}(this),function(){define("beez-mvcr/cssmanager",["require","exports","module","beez.core"],function(e){var t=e("beez.core"),r=t.getLogger("beez.mvcr.cssmanager"),i=t.vendor._,n=t.vendor.$,o=function o(e){var t=document.styleSheets,r=i.find(t,function(t){var r=t.href;return r&&-1!==r.indexOf(e)});return r&&r.rules&&r.rules.length>0},s=function s(e){var t=document.styleSheets,r=i.find(t,function(t){var r=t.href;return r&&-1!==r.indexOf(e)});return!!r},a=t.Bucks.extend("beez.mvcr.CSSManagerAsync",{initialize:function(e){this.manager=e,this._path="",this._intervalId=void 0,this._timeoutId=void 0,this.INTERVAL=t.config.manager&&t.config.manager.css&&t.config.manager.css.interval||50,this.TIMEOUT=t.config.manager&&t.config.manager.css&&t.config.manager.css.timeout||1e4},load:function(e){var o=this,a=this._path=e;if(e.match(/^(http|https):\/\/.+$/)||(a=this._path=this.manager.name2path(e)),!a)return this.empty();if(this.manager.isLoaded(a))return r.debug("path:",a,"already exists"),a=void 0,this.empty();var u='<link rel="stylesheet" href="'+i.escape(a)+'" ></link>';return n("head").append(u),this.then(function(e,i){o._intervalId=setInterval(function(){s(a)&&(o.abort(),r.debug("load finished. path:",a),i())},o.INTERVAL),o._timeoutId=setTimeout(function(){o.abort(),i(new t.Error("loading timed out. path:"+a))},o.TIMEOUT)})},remove:function(e){var t=this;return this.then(function(){return t.manager.remove(e)})},abort:function(){clearTimeout(this._timeoutId),clearInterval(this._intervalId),delete this._timeoutId,delete this._intervalId,delete this.INTERVAL,delete this.TIMEOUT},dispose:function(){r.trace(this.constructor.name,"dispose"),delete this.manager,delete this._path,this.abort()}}),u=t.extend("beez.mvcr.CSSManager",function(){return this.initialize()},{initialize:function(){this._basePath="",t.config.url&&t.config.url.base&&(this._basePath=t.config.url.base,this._basePath.replace(/\/$/,""))},name2path:function(e){var t="";return t=this._basePath?0===e.indexOf("/")?this._basePath+e:this._basePath+"/"+e:e},async:function(){return new a(this)},remove:function(e){var t=n("link[rel=stylesheet]");return t.each(function(){-1!==this.href.indexOf(e)&&(r.debug("remove finished. name:",e,"path:",this.href),n(this).remove())}),this},isExists:o,isLoaded:s,dispose:function(){r.trace(this.constructor.name,"dispose"),delete this._basePath}});return{CSSManager:u,CSSManagerAsync:a}})}(this),function(){define("beez-mvcr/imagemanager",["require","exports","module","beez.core","beez.utils"],function(e){var t=e("beez.core");e("beez.utils");var r=t.vendor._,i=t.vendor.$,n=t.getLogger("beez.mvcr.imagemanager"),o="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAMAAAAoyzS7AAAABlBMVEX///8AAABVwtN+AAAAAXRSTlMAQObYZgAAAA1JREFUeNoBAgD9/wAAAAIAAVMrnDAAAAAASUVORK5CYII=",s=0,a=function a(){return"__beez_manager_image_uid_"+s++},u=t.extend("beez.mvcr.ImagePool",function(e,t){return this.initialize(e,t)},{initialize:function(e,t){this.options=t||{},this.limit=e,this._total=0,this._num_used=0,this._using={},this._unused=[]},create:function(e){var r;if(e=e||{},this._unused.length>0)r=this._unused.pop();else{if(this.limit>0&&this._total>=this.limit)throw new t.Error("image pool limit exceeds!");r=new Image,r.__beez_manager_image_uid=a(),this._total++}e.crossOrigin?r.crossOrigin=e.crossOrigin:this.options.crossOrigin&&(r.crossOrigin=this.options.crossOrigin),this._num_used++,this._using[r.__beez_manager_image_uid]=r;var i=this;return r.release=function(){this.crossOrigin=null,this.src=o,i._using&&delete i._using[this.__beez_manager_image_uid],i._unused&&i._unused.push(this),i._num_used&&i._num_used--,delete this.release},r},living:function(){return this._num_used},peak:function(){return this._total},waiting:function(){return this._unused.length},dispose:function(){n.trace(this.constructor.name,"dispose");for(var e in this._using)this._using[e].release();for(delete this._using;this._unused.length>0;){var t=this._unused.pop();delete t.__beez_manager_image_uid}delete this._unused,delete this._num_used,delete this._total,delete this._limit}}),c=t.Bucks.extend("beez.mvcr.ImageManagerAsync",{initialize:function(e){this.imageManager=e},loadOne:function(e,r){var n=this.imageManager.create(r),o=this;return this.add(function(r,s,a){var u=i(n),c=function c(){u.off(),a(null,n)},h=function h(){var e=n.src;u.off(),n.release(),a(new t.Error("error on load image. src:"+e))},l=function l(){var e=n.src;u.off(),n.release(),a(new t.Error("image loading aborted. src:"+e))};u.on("load",c),u.on("error",h),u.on("abort",l);var d=o.imageManager.imageUrl(e);n.src=d})},load:function(e,i){if(r.isString(e))e=[e];else if(!r.isArray(e))throw new t.Error("url can be String or Array of string.");if(i=i||{},!r.isArray(i)){if(!r.isObject(i))throw new t.Error("options can be Object or Array of object.");i=[i]}var n=this,o=r.map(e,function(e,t){return function(r,o,s){new c(n.imageManager).loadOne(e,i[t]).end(function(e,t){s(e,t[0])},function(e){s(e)})}});return this.parallel(o)},dispose:function(){delete this.imageManager}}),h=t.extend("beez.mvcr.ImageManager",function(e){return this.initialize(e)},{initialize:function(e){var t=e&&e.size?e.size:0,r=e&&e.pool?e.pool:{};this.pool=new u(t,r)},imageUrl:function(e){return e.replace("${ratio}",10*t.utils.pixelRatio)},create:function(e){return this.pool.create(e)},living:function(){return this.pool.living()},peak:function(){return this.pool.peak()},waiting:function(){return this.pool.waiting()},load:function(e,t){return new c(this).load(e,t)},loadOne:function(e,t){return new c(this).loadOne(e,t)},dispose:function(){n.trace(this.constructor.name,"dispose"),this.pool.dispose(),delete this.pool}});return{ImageManager:h,ImageManagerAsync:c}})}(this),function(){define("beez.mvcr",["require","exports","module","beez.core","handlebars","beez-mvcr/model","beez-mvcr/modic","beez-mvcr/view","beez-mvcr/controller","beez-mvcr/router","beez-mvcr/cssmanager","beez-mvcr/imagemanager","beez-mvcr/base","backbone","beez-mvcr/model","beez-mvcr/view","beez-mvcr/controller","beez-mvcr/router","beez-mvcr/cssmanager","beez-mvcr/imagemanager"],function(e){var t=e("beez.core"),r=t.getLogger("beez.mvcr");if(t.mvcr)return r.debug("beez.mvcr already defined."),t.mvcr;var i=e("handlebars");t.getTemplate=function(e){return i.templates[e]};var n={initialize:function(){var t=e("beez-mvcr/model"),r=e("beez-mvcr/modic"),i=e("beez-mvcr/view"),n=e("beez-mvcr/controller"),o=e("beez-mvcr/router"),s=e("beez-mvcr/cssmanager"),a=e("beez-mvcr/imagemanager"),u=e("beez-mvcr/base");this.Model=t.Model,this.ModelManager=t.ModelManager,this.ModelManagerAsync=t.ModelManagerAsync,this.Collection=t.Collection,this.Modic=r.Modic,this.View=i.View,this.ViewAsync=i.ViewAsync,this.ViewManager=i.ViewManager,this.ViewManagerAsync=i.ViewManagerAsync,this.Controller=n.Controller,this.ControllerManager=n.ControllerManager,this.ControllerManagerAsync=n.ControllerManagerAsync,this.Router=o.Router,this.RouterManager=o.RouterManager,this.CSSManager=s.CSSManager,this.CSSManagerAsync=s.CSSManagerAsync,this.ImageManager=a.ImageManager,this.ImageManagerAsync=a.ImageManagerAsync,this.ManagerBase=u.ManagerBase,this.Base=u.Base}},o=t.extend("beez.MVCR",function(){return this.initialize()},n),s=new o;t.mvcr=s,t.Model=s.Model,t.Collection=s.Collection,t.Modic=s.Modic,t.View=s.View,t.Controller=s.Controller,t.Router=s.Router;var a=e("backbone");t.history=a.history;var u=t.config.manager||{},c={initialize:function(){this.setuped=!1,this.model=void 0,this.m=void 0,this.view=void 0,this.v=void 0,this.controller=void 0,this.c=void 0,this.router=void 0,this.r=void 0,this.css=void 0,this.image=void 0},setup:function(t){if(this.setuped)return this;if(t=t||{},this.setuped=!0,t.model)this.model=t.model;else{var r=e("beez-mvcr/model");this.model=new r.ModelManager("midx")}if(this.m=this.model,t.view)this.view=t.view;else{var i=e("beez-mvcr/view");this.view=new i.ViewManager("vidx")}if(this.v=this.view,t.controller)this.controller=t.controller;else{var n=e("beez-mvcr/controller");this.controller=new n.ControllerManager}if(this.c=this.controller,t.router)this.router=t.router;else{var o=e("beez-mvcr/router");this.router=new o.RouterManager}if(this.r=this.router,t.css)this.css=t.css;else{var s=e("beez-mvcr/cssmanager");this.css=new s.CSSManager}if(t.image)this.image=t.image;else{var a=e("beez-mvcr/imagemanager");this.image=new a.ImageManager(u.image)}return this}},h=t.extend("beez.Manager",function(){return this.initialize()},c),l=new h;return s.manager=l,t.manager=s.manager,t.mvcr})}(this);var VERSION="1.0.5";"undefined"!=typeof module&&module.exports?exports.VERSION=VERSION:(VERSION=VERSION,function(){define("beez",["require","exports","module","beez.core","beez.mvcr","beez.utils","beez.i18n","beez.ua"],function(e){var t=e("beez.core");return e("beez.mvcr"),e("beez.utils"),e("beez.i18n"),e("beez.ua"),t})}(this));